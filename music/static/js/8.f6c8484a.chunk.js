(this["webpackJsonpreact-template"]=this["webpackJsonpreact-template"]||[]).push([[8],{193:function(e,t,n){"use strict";var c=n(203),i={search:function(e){return c.a.get("/search?keywords=".concat(e))},banner:function(){return c.a.get("/banner")},hotRecommend:function(e){return c.a.get("/personalized?limit=".concat(e))},recommendPlaylist:function(e){return c.a.get("/personalized?limit=".concat(e))},newDisk:function(){return c.a.get("/album/newest")},getLyric:function(e){return c.a.get("/lyric?id=".concat(e))},getArtistList:function(e){return c.a.get("/artist/list",{params:e})},getPlaylistDetail:function(e){return c.a.get("/playlist/detail",{params:e})},getTopList:function(){return c.a.get("/toplist")},getSongUrl:function(e){return c.a.get("/song/url?id=".concat(e))}};t.a=i},197:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var c=n(66),i=function(e){return{type:c.a,payload:e}}},202:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return u}));var c=n(193),i=n(197),a=n(28),r=function(e){return{type:a.a,payload:e}},s=function(e){return{type:a.c,payload:e}},o=function(){return{type:a.b}},l=function(e){return{type:a.d,payload:e}},u=function(e,t){return function(n){c.a.getPlaylistDetail({id:e}).then((function(e){if(200===e.data.code){var c,a=(null===(c=e.data.playlist)||void 0===c?void 0:c.tracks)||[];n(l(a)),a.length&&(n(Object(i.a)(a[0])),t&&t(a))}})).catch((function(){}))}}},203:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(196);var c=n(53),i=n.n(c),a=n(189),r=n.n(a).a.create({baseURL:"http://123.57.176.198:3000/",timeout:8e3});r.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),r.interceptors.response.use((function(e){return 200!==e.status&&i.a.error("\u7cfb\u7edf\u9519\u8bef"),e}),(function(e){return-1!==e.message.search("timeout")?e.message="\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u4fdd\u6301\u826f\u597d\u7684\u7f51\u7edc\u73af\u5883\u3002":e.message="\u7cfb\u7edf\u8bf7\u6c42\u5f02\u5e38",i.a.error(e.message),Promise.reject(e)}))},204:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var c=n(67),i=function(){return{type:c.a}}},211:function(e,t,n){"use strict";var c=n(212),i={formatTenThousand:function(e){return e>=1e4?(e/1e4).toFixed(0)+"\u4e07":e},parseLyric:function(e){var t=/\[([0-9]{2}):([0-9]{2})\.([0-9]{1,3})\]/;if(e){var n,i=e.split("\n"),a=[],r=Object(c.a)(i);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s){var o=t.exec(s);if(!o)continue;var l={totalTime:60*o[1]*1e3+1e3*o[2]+1e3*Number("0."+String(o[3])),content:s.replace(t,"").trim()};a.push(l)}}}catch(u){r.e(u)}finally{r.f()}return a=a.sort((function(e,t){return e.totalTime-t.totalTime}))}},getArtistStr:function(e){return(e||[]).map((function(e,t){return 0===t?e.name:"/"+e.name})).join("")}};t.a=i},236:function(e,t,n){},237:function(e,t,n){e.exports={PlayBar:"PlayBar_PlayBar__1UJ2Q",container:"PlayBar_container__1vXZO",songListAndLyricWrapper:"PlayBar_songListAndLyricWrapper__3ULpg",songListAndLyric:"PlayBar_songListAndLyric__1GGdN","bg-l":"PlayBar_bg-l__Vw__p",miniLock:"PlayBar_miniLock__3Ssve",btn:"PlayBar_btn__1XzpM",lock:"PlayBar_lock__fxbdH",unlock:"PlayBar_unlock__FFOwT","bg-r":"PlayBar_bg-r__1wY_k"}},314:function(e,t,n){"use strict";n.r(t);n(222);var c=n(225),i=n.n(c),a=(n(234),n(243)),r=n.n(a),s=(n(196),n(53)),o=n.n(s),l=n(195),u=n(7),d=n(319),f=n(320),j=n(321),m=n(322),b=n(323),v=n(0),g=n(47),h=n(295),O=n(311),p=(n(236),function(e){var t=e.mode,n=e.children,c=Object(h.a)(e,["mode","children"]);return Object(u.jsx)(O.a,Object(g.a)(Object(g.a)({classNames:"transition-".concat(t)},c),{},{children:n}))});p.defaultProps={mode:"fade"};var y=p,_=n(61),x=n(190),N=n.n(x),L=n(211),k=n(219),S=n(310),P=n(202),C=n(197),w=n(237),B=n.n(w),T=n(204),A=n(193),E=n(203),I=n(238),R=n.n(I),U=n(239),F=function(e,t,n){var c=Object(v.useState)(0),i=Object(l.a)(c,2),a=i[0],r=i[1],s=Object(v.useRef)({fn:Object(U.a)((function(e){e&&e()}),500)});return Object(v.useEffect)((function(){s.current.fn((function(){if(n.length){var t=n.findIndex((function(t){return t.totalTime>=1e3*e}));t>0&&t-1!==a&&r(t-1)}}))}),[e,t,n,a]),[a]},M=function(e,t){Object(v.useEffect)((function(){var n=function(n){e.current&&!e.current.contains(n.target)&&t()};return document.addEventListener("click",n),function(){document.removeEventListener("click",n)}}),[t,e])},K=["loop","shuffle","one"],V=function(e){var t,n,c=e.songList,a=e.currentSongInfo,s=e.playBarState.isPlay,g=Object(v.useState)(!0),h=Object(l.a)(g,2),O=h[0],p=h[1],_=Object(v.useState)(!1),x=Object(l.a)(_,2),P=x[0],C=x[1],w=Object(v.useState)("loop"),T=Object(l.a)(w,2),I=T[0],U=T[1],V=Object(v.useState)(!1),q=Object(l.a)(V,2),z=q[0],D=q[1],J=Object(v.useState)(!1),W=Object(l.a)(J,2),G=W[0],X=W[1],H=Object(v.useState)(.5),Q=Object(l.a)(H,2),Y=Q[0],Z=Q[1],$=Object(v.useState)(0),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ce=Object(v.useState)(0),ie=Object(l.a)(ce,2),ae=ie[0],re=ie[1],se=Object(v.useState)([]),oe=Object(l.a)(se,2),le=oe[0],ue=oe[1],de=Object(v.useRef)(null),fe=Object(v.useRef)(null);Object(v.useEffect)((function(){}),[]),Object(v.useEffect)((function(){var e,t;s?null===(e=de.current)||void 0===e||e.play().then((function(e){})).catch((function(e){o.a.error(e.message)})):null===(t=de.current)||void 0===t||t.pause()}),[s]),Object(v.useEffect)((function(){de.current&&(de.current.volume=Y)}),[Y]),Object(v.useEffect)((function(){A.a.getLyric(a.id).then((function(e){if(200===e.data.code){var t,n=(null===(t=e.data.lrc)||void 0===t?void 0:t.lyric)||"",c=L.a.parseLyric(n);ue(c||[])}})).catch((function(){}))}),[a.id]),Object(v.useEffect)((function(){return window.onkeyup=function(t){t.ctrlKey&&"ArrowRight"===t.code&&ye(),t.ctrlKey&&"ArrowLeft"===t.code&&pe(),"KeyP"===t.code&&e.change_is_play(),"KeyM"===t.code&&be()},function(){window.onkeyup=null}})),Object(v.useEffect)((function(){var e=document.querySelector(".songList-content .songList-item.active");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),[a.id]);var je=F(ae,a.dt,le),me=Object(l.a)(je,1)[0];Object(v.useEffect)((function(){var e=document.querySelector(".lyric-content .lyric-item.active");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),[me]),M(fe,(function(){G&&X(!1)}));var be=function(){U((function(e){var t=K.findIndex((function(t){return t===e}));return t++,K[t%3]}))},ve=Object(v.useCallback)(Object(k.a)((function(){var e=a.id;e&&A.a.getSongUrl(e).then((function(t){if(200===t.data.code){var n,c,i=(null===(n=t.data)||void 0===n||null===(c=n.data[0])||void 0===c?void 0:c.url)||"";if(i)E.a.get(i,{responseType:"blob"}).then((function(e){if(200===e.status){var t=e.data,n=(null===a||void 0===a?void 0:a.name)||"",c=((null===a||void 0===a?void 0:a.ar)||[]).map((function(e){return e.name})).join(" ");R.a.saveAs(t,"".concat(c," - ").concat(n,".mp3"))}})).catch((function(){}));else{var r=document.createElement("a");r.href="https://music.163.com/song/media/outer/url?id=".concat(e,".mp3"),r.target="_blank",r.click()}}})).catch((function(){}))}),5e3,{leading:!0,trailing:!1}),[a.id]),ge=function(){if(1===c.length)he();else if(c.length>1){var t=Object(S.a)(c.filter((function(e){return e.id!==a.id})));e.change_current_song_info(t),he()}else o.a.info("\u6682\u65e0\u968f\u673a\u64ad\u653e\u6b4c\u66f2")},he=function(){setTimeout((function(){de.current&&(de.current.currentTime=0)}),50)},Oe=function(){if(c.length>1){var t=c.findIndex((function(e){return e.id===a.id}));if(t===c.length-1)e.change_current_song_info(c[0]);else{var n=c[t+1];e.change_current_song_info(n)}}},pe=function(){return"one"===I||"loop"===I?function(){if(c.length>1){var t=c.findIndex((function(e){return e.id===a.id}));if(0===t)e.change_current_song_info(c[c.length-1]);else{var n=c[t-1];e.change_current_song_info(n)}}}():"shuffle"===I?ge():void 0},ye=function(){return"one"===I||"loop"===I?Oe():"shuffle"===I?ge():void 0};return Object(u.jsxs)("div",{ref:fe,className:B.a.PlayBar,style:{bottom:O||P?0:-46},onMouseEnter:function(){O||(clearTimeout(n),P||C(!0))},onMouseLeave:function(){O||(clearTimeout(n),n=setTimeout((function(){return C(!1)}),1e3))},children:[Object(u.jsxs)("div",{className:[B.a.container,"w980"].join(" "),children:[Object(u.jsxs)("div",{className:"playBtns",children:[Object(u.jsx)("div",{className:"prev",title:"\u4e0a\u4e00\u9996(Ctrl+\u2190)",onClick:pe}),Object(u.jsx)("div",{className:s?"play":"stop",title:s?"\u6682\u505c(P)":"\u64ad\u653e(P)",onClick:function(){return e.change_is_play()}}),Object(u.jsx)("div",{className:"next",title:"\u4e0b\u4e00\u9996(Ctrl+\u2192)",onClick:ye})]}),Object(u.jsxs)("div",{className:"currentSongInfo",children:[Object(u.jsx)("img",{src:null===a||void 0===a||null===(t=a.al)||void 0===t?void 0:t.picUrl,alt:""}),Object(u.jsxs)("div",{className:"currentSongInfoRight",children:[Object(u.jsxs)("div",{className:"right-t",children:[Object(u.jsx)("div",{className:"songName",children:a.name}),Object(u.jsx)("div",{className:"songAuthor",children:L.a.getArtistStr(a.ar)})]}),Object(u.jsxs)("div",{className:"right-b",children:[Object(u.jsx)("div",{className:"process-bar",children:Object(u.jsx)(r.a,{value:te,min:0,max:1,step:.001,tooltipVisible:!1,onChange:function(t){ne(t);var n=t*a.dt/1e3;de.current&&(de.current.currentTime=n,s||e.change_is_play())}})}),Object(u.jsxs)("div",{className:"time",children:[Object(u.jsxs)("span",{className:"play-time",children:[N()(te*a.dt).format("mm:ss")," "]}),Object(u.jsxs)("span",{className:"total-time",children:["/ ",N()(a.dt).format("mm:ss")]})]})]})]})]}),Object(u.jsxs)("div",{className:"leftBtns",children:[Object(u.jsx)(i.a,{title:"\u4e0b\u8f7d\u97f3\u4e50",children:Object(u.jsx)(d.a,{className:"icon",onClick:ve})}),Object(u.jsx)(i.a,{title:"\u91cd\u65b0\u64ad\u653e",children:Object(u.jsx)(f.a,{className:"icon",onClick:he})})]}),Object(u.jsxs)("div",{className:"rightBtns",children:[Object(u.jsx)("div",{className:"btn voice",onClick:function(){return D(!z)},children:Object(u.jsx)(y,{mode:"scale",in:z,timeout:300,children:Object(u.jsx)("div",{className:"voice-bar",children:Object(u.jsx)("div",{style:{height:110},children:Object(u.jsx)(r.a,{min:0,max:1,step:.01,vertical:!0,value:Y,tipFormatter:function(e){var t;return null===(t=e&&100*e)||void 0===t?void 0:t.toFixed(0)},onChange:function(e){return Z(e)}})})})})}),Object(u.jsx)(i.a,{title:"".concat(function(){switch(I){case"loop":return"\u987a\u5e8f\u64ad\u653e";case"shuffle":return"\u968f\u673a\u64ad\u653e";case"one":return"\u5355\u66f2\u5faa\u73af";default:return null}}(),"(M)"),children:Object(u.jsx)("div",{className:"btn circle-mode ".concat(I),onClick:be})}),Object(u.jsx)("div",{className:"btn song-list",onClick:function(){return X(!G)},children:Object(u.jsx)("div",{className:"songCount",children:(null===c||void 0===c?void 0:c.length)||0})})]})]}),Object(u.jsx)("audio",{id:"audio",ref:de,onTimeUpdate:function(e){var t=e.currentTarget.currentTime,n=+(1e3*t/a.dt).toFixed(3);n!==te&&(re(t),ne(n))},onEnded:function(e){switch(I){case"loop":Oe();break;case"shuffle":ge();break;case"one":he()}},preload:"auto",onCanPlay:function(){s&&de.current&&de.current.play()},src:"https://music.163.com/song/media/outer/url?id=".concat(a.id,".mp3")}),Object(u.jsx)(y,{mode:"scale",in:G,timeout:300,children:Object(u.jsx)("div",{className:B.a.songListAndLyricWrapper,children:Object(u.jsxs)("div",{className:B.a.songListAndLyric,children:[Object(u.jsxs)("div",{className:"songList",children:[Object(u.jsxs)("div",{className:"songList-title",children:[Object(u.jsxs)("div",{className:"songList-title-l",children:["\u64ad\u653e\u5217\u8868(",(null===c||void 0===c?void 0:c.length)||0,")"]}),Object(u.jsxs)("div",{className:"songList-title-r",title:"\u6e05\u9664\u64ad\u653e\u5217\u8868",onClick:function(){c.length&&(e.clear_song_list(),o.a.success("\u5217\u8868\u6e05\u7a7a\u6210\u529f"))},children:[Object(u.jsx)(j.a,{className:"icon"})," \u6e05\u9664"]})]}),Object(u.jsx)("div",{className:"songList-content custom-scroll-bar",children:c.map((function(t){return Object(u.jsxs)("div",{className:"songList-item ".concat(a.id===t.id?"active":""),onClick:function(){return function(t){if(t.id!==a.id)return s?void e.change_current_song_info(t):e.change_is_play()}(t)},children:[Object(u.jsx)("div",{className:"redIcon",children:Object(u.jsx)(m.a,{className:"icon"})}),Object(u.jsx)("div",{className:"songList-item-name ellipsis-1",children:t.name}),Object(u.jsx)("div",{className:"btns",children:Object(u.jsx)(j.a,{title:"\u5220\u9664",className:"icon",onClick:function(n){return function(t,n){n.stopPropagation(),a.id===t&&(1===c.length||Oe()),e.del_song_list_item(t)}(t.id,n)}})}),Object(u.jsx)("div",{className:"songList-item-author ellipsis-1",children:L.a.getArtistStr(t.ar)}),Object(u.jsx)("div",{className:"songList-item-time",children:N()(t.dt).format("mm:ss")})]},t.id)}))})]}),Object(u.jsxs)("div",{className:"lyric",children:[Object(u.jsxs)("div",{className:"lyric-title",children:[a.name,Object(u.jsx)(b.a,{title:"\u5173\u95ed",onClick:function(){return X(!1)},className:"icon"})]}),Object(u.jsx)("div",{className:"lyric-content custom-scroll-bar",children:le.map((function(e,t){return Object(u.jsx)("div",{className:"lyric-item  ellipsis-1 ".concat(me===t?"active":""),children:e.content},t)}))})]})]})})}),Object(u.jsx)("div",{className:B.a["bg-l"]}),Object(u.jsx)("div",{className:B.a.miniLock,children:Object(u.jsx)("div",{className:[B.a.btn,O?B.a.lock:B.a.unlock].join(" "),onClick:function(){return p(!O)}})}),Object(u.jsx)("div",{className:B.a["bg-r"]})]})};V.defaultProps={};t.default=Object(_.b)((function(e){return{songList:e.songList,currentSongInfo:e.currentSongInfo,playBarState:e.playBarState}}),(function(e){return{clear_song_list:function(){return e(Object(P.b)())},del_song_list_item:function(t){return e(Object(P.c)(t))},change_current_song_info:function(t){return e(Object(C.a)(t))},change_is_play:function(){return e(Object(T.a)())}}}))(V)}}]);