(this["webpackJsonpreact-template"]=this["webpackJsonpreact-template"]||[]).push([[8],{193:function(e,t,n){"use strict";var c=n(203),i={search:function(e){return c.a.get("/search?keywords=".concat(e))},banner:function(){return c.a.get("/banner")},hotRecommend:function(e){return c.a.get("/personalized?limit=".concat(e))},recommendPlaylist:function(e){return c.a.get("/personalized?limit=".concat(e))},newDisk:function(){return c.a.get("/album/newest")},getLyric:function(e){return c.a.get("/lyric?id=".concat(e))},getArtistList:function(e){return c.a.get("/artist/list",{params:e})},getPlaylistDetail:function(e){return c.a.get("/playlist/detail",{params:e})},getTopList:function(){return c.a.get("/toplist")},getSongUrl:function(e){return c.a.get("/song/url?id=".concat(e))}};t.a=i},197:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var c=n(66),i=function(e){return{type:c.a,payload:e}}},202:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return u}));var c=n(193),i=n(197),r=n(28),a=function(e){return{type:r.a,payload:e}},s=function(e){return{type:r.c,payload:e}},o=function(){return{type:r.b}},l=function(e){return{type:r.d,payload:e}},u=function(e,t){return function(n){c.a.getPlaylistDetail({id:e}).then((function(e){if(200===e.data.code){var c,r=(null===(c=e.data.playlist)||void 0===c?void 0:c.tracks)||[];n(l(r)),r.length&&(n(Object(i.a)(r[0])),t&&t(r))}})).catch((function(){}))}}},203:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(196);var c=n(53),i=n.n(c),r=n(189),a=n.n(r).a.create({baseURL:"http://123.57.176.198:3000/",timeout:8e3});a.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),a.interceptors.response.use((function(e){return 200!==e.status&&i.a.error("\u7cfb\u7edf\u9519\u8bef"),e}),(function(e){return-1!==e.message.search("timeout")?e.message="\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u4fdd\u6301\u826f\u597d\u7684\u7f51\u7edc\u73af\u5883\u3002":e.message="\u7cfb\u7edf\u8bf7\u6c42\u5f02\u5e38",i.a.error(e.message),Promise.reject(e)}))},204:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var c=n(67),i=function(){return{type:c.a}}},211:function(e,t,n){"use strict";var c=n(212),i={formatTenThousand:function(e){return e>=1e4?(e/1e4).toFixed(0)+"\u4e07":e},parseLyric:function(e){var t=/\[([0-9]{2}):([0-9]{2})\.([0-9]{1,3})\]/;if(e){var n,i=e.split("\n"),r=[],a=Object(c.a)(i);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s){var o=t.exec(s);if(!o)continue;var l={totalTime:60*o[1]*1e3+1e3*o[2]+1e3*Number("0."+String(o[3])),content:s.replace(t,"").trim()};r.push(l)}}}catch(u){a.e(u)}finally{a.f()}return r=r.sort((function(e,t){return e.totalTime-t.totalTime}))}},getArtistStr:function(e){return(e||[]).map((function(e,t){return 0===t?e.name:"/"+e.name})).join("")}};t.a=i},238:function(e,t,n){},239:function(e,t,n){e.exports={PlayBar:"PlayBar_PlayBar__1UJ2Q",container:"PlayBar_container__1vXZO",songListAndLyricWrapper:"PlayBar_songListAndLyricWrapper__3ULpg",songListAndLyric:"PlayBar_songListAndLyric__1GGdN","bg-l":"PlayBar_bg-l__Vw__p",miniLock:"PlayBar_miniLock__3Ssve",btn:"PlayBar_btn__1XzpM",lock:"PlayBar_lock__fxbdH",unlock:"PlayBar_unlock__FFOwT","bg-r":"PlayBar_bg-r__1wY_k"}},316:function(e,t,n){"use strict";n.r(t);n(233);var c=n(97),i=n.n(c),r=(n(222),n(225)),a=n.n(r),s=(n(236),n(245)),o=n.n(s),l=(n(196),n(53)),u=n.n(l),d=n(195),f=n(7),j=n(321),m=n(322),b=n(323),v=n(324),g=n(325),h=n(0),O=n(47),p=n(297),y=n(313),x=(n(238),function(e){var t=e.mode,n=e.children,c=Object(p.a)(e,["mode","children"]);return Object(f.jsx)(y.a,Object(O.a)(Object(O.a)({classNames:"transition-".concat(t)},c),{},{children:n}))});x.defaultProps={mode:"fade"};var _=x,N=n(61),L=n(190),k=n.n(L),S=n(211),P=n(219),C=n(312),w=n(202),E=n(197),B=n(239),T=n.n(B),A=n(204),I=n(193),R=n(203),M=n(240),U=n.n(M),F=n(241),D=function(e,t,n){var c=Object(h.useState)(0),i=Object(d.a)(c,2),r=i[0],a=i[1],s=Object(h.useRef)({fn:Object(F.a)((function(e){e&&e()}),500)});return Object(h.useEffect)((function(){s.current.fn((function(){if(n.length){var t=n.findIndex((function(t){return t.totalTime>=1e3*e}));t>0&&t-1!==r&&a(t-1)}}))}),[e,t,n,r]),[r]},K=function(e,t){Object(h.useEffect)((function(){var n=function(n){e.current&&!e.current.contains(n.target)&&t()};return document.addEventListener("click",n),function(){document.removeEventListener("click",n)}}),[t,e])},V=["loop","shuffle","one"],q=function(e){var t,n,c=e.songList,r=e.currentSongInfo,s=e.playBarState.isPlay,l=Object(h.useState)(!0),O=Object(d.a)(l,2),p=O[0],y=O[1],x=Object(h.useState)(!1),N=Object(d.a)(x,2),L=N[0],w=N[1],E=Object(h.useState)("loop"),B=Object(d.a)(E,2),A=B[0],M=B[1],F=Object(h.useState)(!1),q=Object(d.a)(F,2),z=q[0],G=q[1],J=Object(h.useState)(!1),W=Object(d.a)(J,2),X=W[0],H=W[1],Q=Object(h.useState)(.5),Y=Object(d.a)(Q,2),Z=Y[0],$=Y[1],ee=Object(h.useState)(0),te=Object(d.a)(ee,2),ne=te[0],ce=te[1],ie=Object(h.useState)(0),re=Object(d.a)(ie,2),ae=re[0],se=re[1],oe=Object(h.useState)([]),le=Object(d.a)(oe,2),ue=le[0],de=le[1],fe=Object(h.useRef)(null),je=Object(h.useRef)(null);Object(h.useEffect)((function(){}),[]),Object(h.useEffect)((function(){var e,t;s?null===(e=fe.current)||void 0===e||e.play().then((function(e){})).catch((function(e){u.a.error(e.message)})):null===(t=fe.current)||void 0===t||t.pause()}),[s]),Object(h.useEffect)((function(){fe.current&&(fe.current.volume=Z)}),[Z]),Object(h.useEffect)((function(){I.a.getLyric(r.id).then((function(e){if(200===e.data.code){var t,n=(null===(t=e.data.lrc)||void 0===t?void 0:t.lyric)||"",c=S.a.parseLyric(n);de(c||[])}})).catch((function(){}))}),[r.id]),Object(h.useEffect)((function(){return window.onkeyup=function(t){t.ctrlKey&&"ArrowRight"===t.code&&xe(),t.ctrlKey&&"ArrowLeft"===t.code&&ye(),"KeyP"===t.code&&e.change_is_play(),"KeyM"===t.code&&ve()},function(){window.onkeyup=null}})),Object(h.useEffect)((function(){var e=document.querySelector(".songList-content .songList-item.active");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),[r.id]);var me=D(ae,r.dt,ue),be=Object(d.a)(me,1)[0];Object(h.useEffect)((function(){var e=document.querySelector(".lyric-content .lyric-item.active");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),[be]),K(je,(function(){X&&H(!1)}));var ve=function(){M((function(e){var t=V.findIndex((function(t){return t===e}));return t++,V[t%3]}))},ge=Object(h.useCallback)(Object(P.a)((function(){var e=r.id;e&&I.a.getSongUrl(e).then((function(t){if(200===t.data.code){var n,c,i=(null===(n=t.data)||void 0===n||null===(c=n.data[0])||void 0===c?void 0:c.url)||"";if(i)R.a.get(i,{responseType:"blob"}).then((function(e){if(200===e.status){var t=e.data,n=(null===r||void 0===r?void 0:r.name)||"",c=((null===r||void 0===r?void 0:r.ar)||[]).map((function(e){return e.name})).join(" ");U.a.saveAs(t,"".concat(c," - ").concat(n,".mp3"))}})).catch((function(){}));else{var a=document.createElement("a");a.href="https://music.163.com/song/media/outer/url?id=".concat(e,".mp3"),a.target="_blank",a.click()}}})).catch((function(){}))}),5e3,{leading:!0,trailing:!1}),[r.id]),he=function(){if(1===c.length)Oe();else if(c.length>1){var t=Object(C.a)(c.filter((function(e){return e.id!==r.id})));e.change_current_song_info(t),Oe()}else u.a.info("\u6682\u65e0\u968f\u673a\u64ad\u653e\u6b4c\u66f2")},Oe=function(){setTimeout((function(){fe.current&&(fe.current.currentTime=0)}),50)},pe=function(){if(c.length>1){var t=c.findIndex((function(e){return e.id===r.id}));if(t===c.length-1)e.change_current_song_info(c[0]),s&&Oe();else{var n=c[t+1];e.change_current_song_info(n),s&&Oe()}}},ye=function(){return"one"===A||"loop"===A?function(){if(c.length>1){var t=c.findIndex((function(e){return e.id===r.id}));if(0===t)e.change_current_song_info(c[c.length-1]);else{var n=c[t-1];e.change_current_song_info(n)}}}():"shuffle"===A?he():void 0},xe=function(){return"one"===A||"loop"===A?pe():"shuffle"===A?he():void 0};return Object(f.jsxs)("div",{ref:je,className:T.a.PlayBar,style:{bottom:p||L?0:-46},onMouseEnter:function(){p||(clearTimeout(n),L||w(!0))},onMouseLeave:function(){p||(clearTimeout(n),n=setTimeout((function(){return w(!1)}),1e3))},children:[Object(f.jsxs)("div",{className:[T.a.container,"w980"].join(" "),children:[Object(f.jsxs)("div",{className:"playBtns",children:[Object(f.jsx)("div",{className:"prev",title:"\u4e0a\u4e00\u9996(Ctrl+\u2190)",onClick:ye}),Object(f.jsx)("div",{className:s?"play":"stop",title:s?"\u6682\u505c(P)":"\u64ad\u653e(P)",onClick:function(){return e.change_is_play()}}),Object(f.jsx)("div",{className:"next",title:"\u4e0b\u4e00\u9996(Ctrl+\u2192)",onClick:xe})]}),Object(f.jsxs)("div",{className:"currentSongInfo",children:[Object(f.jsx)("img",{src:null===r||void 0===r||null===(t=r.al)||void 0===t?void 0:t.picUrl,alt:""}),Object(f.jsxs)("div",{className:"currentSongInfoRight",children:[Object(f.jsxs)("div",{className:"right-t",children:[Object(f.jsx)("div",{className:"songName ellipsis-1",children:r.name}),Object(f.jsx)("div",{className:"songAuthor ellipsis-1",children:S.a.getArtistStr(r.ar)})]}),Object(f.jsxs)("div",{className:"right-b",children:[Object(f.jsx)("div",{className:"process-bar",children:Object(f.jsx)(o.a,{value:ne,min:0,max:1,step:.001,tooltipVisible:!1,onChange:function(t){ce(t);var n=t*r.dt/1e3;fe.current&&(fe.current.currentTime=n,s||e.change_is_play())}})}),Object(f.jsxs)("div",{className:"time",children:[Object(f.jsxs)("span",{className:"play-time",children:[k()(ne*r.dt).format("mm:ss")," "]}),Object(f.jsxs)("span",{className:"total-time",children:["/ ",k()(r.dt).format("mm:ss")]})]})]})]})]}),Object(f.jsxs)("div",{className:"leftBtns",children:[Object(f.jsx)(a.a,{title:"\u4e0b\u8f7d\u97f3\u4e50",children:Object(f.jsx)(j.a,{className:"icon",onClick:ge})}),Object(f.jsx)(a.a,{title:"\u91cd\u65b0\u64ad\u653e",children:Object(f.jsx)(m.a,{className:"icon",onClick:Oe})})]}),Object(f.jsxs)("div",{className:"rightBtns",children:[Object(f.jsx)("div",{className:"btn voice",onClick:function(){return G(!z)},children:Object(f.jsx)(_,{mode:"scale",in:z,timeout:300,children:Object(f.jsx)("div",{className:"voice-bar",children:Object(f.jsx)("div",{style:{height:110},children:Object(f.jsx)(o.a,{min:0,max:1,step:.01,vertical:!0,value:Z,tipFormatter:function(e){var t;return null===(t=e&&100*e)||void 0===t?void 0:t.toFixed(0)},onChange:function(e){return $(e)}})})})})}),Object(f.jsx)(a.a,{title:"".concat(function(){switch(A){case"loop":return"\u987a\u5e8f\u64ad\u653e";case"shuffle":return"\u968f\u673a\u64ad\u653e";case"one":return"\u5355\u66f2\u5faa\u73af";default:return null}}(),"(M)"),children:Object(f.jsx)("div",{className:"btn circle-mode ".concat(A),onClick:ve})}),Object(f.jsx)("div",{className:"btn song-list",onClick:function(){return H(!X)},children:Object(f.jsx)("div",{className:"songCount",children:(null===c||void 0===c?void 0:c.length)||0})})]})]}),Object(f.jsx)("audio",{id:"audio",ref:fe,onTimeUpdate:function(e){var t=e.currentTarget.currentTime,n=+(1e3*t/r.dt).toFixed(3);n!==ne&&(se(t),ce(n))},onEnded:function(e){switch(A){case"loop":pe();break;case"shuffle":he();break;case"one":Oe()}},onError:function(e){u.a.info("\u5f53\u524d\u6b4c\u66f2\u65e0\u6cd5\u64ad\u653e,\u81ea\u52a8\u64ad\u653e\u4e0b\u4e00\u9996"),xe()},preload:"auto",onCanPlay:function(){s&&fe.current&&fe.current.play()},src:"https://music.163.com/song/media/outer/url?id=".concat(r.id,".mp3")}),Object(f.jsx)(_,{mode:"scale",in:X,timeout:300,children:Object(f.jsx)("div",{className:T.a.songListAndLyricWrapper,children:Object(f.jsxs)("div",{className:T.a.songListAndLyric,children:[Object(f.jsxs)("div",{className:"songList",children:[Object(f.jsxs)("div",{className:"songList-title",children:[Object(f.jsxs)("div",{className:"songList-title-l",children:["\u64ad\u653e\u5217\u8868(",(null===c||void 0===c?void 0:c.length)||0,")"]}),Object(f.jsxs)("div",{className:"songList-title-r",title:"\u6e05\u9664\u64ad\u653e\u5217\u8868",onClick:function(){c.length&&(e.clear_song_list(),u.a.success("\u5217\u8868\u6e05\u7a7a\u6210\u529f"))},children:[Object(f.jsx)(b.a,{className:"icon"})," \u6e05\u9664"]})]}),Object(f.jsx)("div",{className:"songList-content custom-scroll-bar",children:c.map((function(t){return Object(f.jsxs)("div",{className:"songList-item ".concat(r.id===t.id?"active":""),onClick:function(){return function(t){if(t.id!==r.id)return s?void e.change_current_song_info(t):e.change_is_play()}(t)},children:[Object(f.jsx)("div",{className:"redIcon",children:Object(f.jsx)(v.a,{className:"icon"})}),Object(f.jsx)("div",{className:"songList-item-name ellipsis-1",children:t.name}),Object(f.jsx)("div",{className:"btns",children:Object(f.jsx)(b.a,{title:"\u5220\u9664",className:"icon",onClick:function(n){return function(t,n){n.stopPropagation(),r.id===t&&(1===c.length||pe()),e.del_song_list_item(t)}(t.id,n)}})}),Object(f.jsx)("div",{className:"songList-item-author ellipsis-1",children:S.a.getArtistStr(t.ar)}),Object(f.jsx)("div",{className:"songList-item-time",children:k()(t.dt).format("mm:ss")})]},t.id)}))})]}),Object(f.jsxs)("div",{className:"lyric",children:[Object(f.jsxs)("div",{className:"lyric-title",children:[r.name,Object(f.jsx)(g.a,{title:"\u5173\u95ed",onClick:function(){return H(!1)},className:"icon"})]}),Object(f.jsxs)("div",{className:"lyric-content custom-scroll-bar",children:[ue.length?ue.map((function(e,t){return Object(f.jsx)("div",{className:"lyric-item  ellipsis-1 ".concat(be===t?"active":""),children:e.content},t)})):null,0===ue.length?Object(f.jsx)("div",{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(f.jsx)(i.a,{style:{color:"white"},description:"\u6682\u65e0\u6b4c\u8bcd\u4fe1\u606f",image:i.a.PRESENTED_IMAGE_SIMPLE})}):null]})]})]})})}),Object(f.jsx)("div",{className:T.a["bg-l"]}),Object(f.jsx)("div",{className:T.a.miniLock,children:Object(f.jsx)("div",{className:[T.a.btn,p?T.a.lock:T.a.unlock].join(" "),onClick:function(){return y(!p)}})}),Object(f.jsx)("div",{className:T.a["bg-r"]})]})};q.defaultProps={};t.default=Object(N.b)((function(e){return{songList:e.songList,currentSongInfo:e.currentSongInfo,playBarState:e.playBarState}}),(function(e){return{clear_song_list:function(){return e(Object(w.b)())},del_song_list_item:function(t){return e(Object(w.c)(t))},change_current_song_info:function(t){return e(Object(E.a)(t))},change_is_play:function(){return e(Object(A.a)())}}}))(q)}}]);